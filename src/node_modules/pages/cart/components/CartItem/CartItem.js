import { useContext, useState } from "react";
import { Link } from "react-router-dom";

import "./CartItem.css";
import Title from "components/Catalog/CardProduct/Title/Title";
import Price from "components/Catalog/CardProduct/Price/Price";
import StepperNum from "components/Stepper/Stepper";
import { OrderContext } from "Context/OrderContext";

export default function CartItem({ item }) {
  const cart = useContext(OrderContext);

  let [qty, setQty] = useState(item.quantity);

  const handlePlus = () => {
    setQty((prevQty) => prevQty + 1);
    item.quantity = qty + 1;
    cart.setTotalPrice((prevTotalPrice) => +prevTotalPrice + +item.price);
  };

  const handleMinus = () => {
    setQty((prevQty) => {
      return prevQty - 1;
    });
    item.quantity = qty - 1;
    cart.setTotalPrice((prevTotalPrice) => +prevTotalPrice - +item.price);
  };

  return (
    <div className="cartItem__container">
      <div className="cartItem__image">
        <img src={item.image[0]} alt={item.title} />
      </div>
      <div className="cartItem__title">
        <Link to={`/catalog/${item.vendorCode}`}>
          <Title title={item.title} />
        </Link>
      </div>
      <div className="cartItem__price">
        <Price currency={item.currency} price={item.price} />
      </div>
      <div className="cartItem__stepper">
        <StepperNum
          handlePlus={handlePlus}
          handleMinus={handleMinus}
          qty={item.quantity}
          id={item.id}
        />
      </div>
      <div className="cartItem__total">
        <Price currency={item.currency} price={item.price * item.quantity} />
      </div>
      <div
        className="cartItem__remove-btn"
        onClick={() => cart.onDelete(item.vendorCode, item.quantity)}
      >
        +
      </div>
    </div>
  );
}
