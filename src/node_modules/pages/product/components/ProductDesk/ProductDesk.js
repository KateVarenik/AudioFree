import { useState, useContext } from "react";
import { Link } from "react-router-dom";
import "./ProductDesk.css";

import CATALOG from "Consts/catalog/catalog";

import Breadcrumb from "components/General/Breadcrumb/Breadcrumb";
import Rating from "components/Catalog/CardProduct/Rating/Rating";
import Price from "components/Catalog/CardProduct/Price/Price";
import LastPrice from "components/Catalog/CardProduct/Price/LastPrice";
import StepperNum from "components/Stepper/Stepper";
import RadioBtn from "components/Buttons/Radio/RadioBtn";
import PurpleButton from "components/Buttons/PurpleButton";
import WhiteGrayButton from "components/Buttons/WhiteGrayButton";
import VendorCode from "../VendorCode/VendorCode";
import CompareButton from "components/Buttons/CompareButton";
import FavoriteButton from "components/Buttons/FavoriteButton";
import AttentionButton from "../AttentionButton/AttentionButton";
import TabsProduct from "../Tabs/Tabs";
import PageTitle from "components/General/Title/PageTitle";
import CardProduct from "components/Catalog/CardProduct/CardProduct";
import MoreInfo from "../MoreInfo/MoreInfo";
import ProductTitle from "../ProductTitle/ProductTitle";
import ProductSliderMain from "pages/product/components/ProductSlider/ProductSliderMain/ProductSliderMain";
import ProductSliderThumbs from "pages/product/components/ProductSlider/ProductSliderThumbs/ProductSliderThumbs";
import ModelTitle from "pages/product/components/ModelTitle/ModelTitle";
import { OrderContext } from "Context/OrderContext";

export const ProductDesk = ({ vendorCode }) => {
  const cart = useContext(OrderContext);
  const productToShow = CATALOG.find((item) => item.vendorCode === +vendorCode);

  const [thumbsSwiper, setThumbsSwiper] = useState(null);
  let [qty, setQty] = useState(productToShow.quantity ?? 1);

  const handlePlus = () => {
    setQty((prevQty) => prevQty + 1);
    productToShow.quantity = qty + 1;
  };

  const handleMinus = () => {
    setQty((prevQty) => {
      return prevQty - 1;
    });
    productToShow.quantity = qty - 1;
  };

  return (
    <div className="product__container container-l">
      <div className="product__info">
        <div className="product__gallery">
          <ProductSliderMain
            thumbs={{ swiper: thumbsSwiper }}
            item={productToShow}
          />
          <ProductSliderThumbs
            onSwiper={setThumbsSwiper}
            item={productToShow}
          />
        </div>
        <div className="product__card">
          <Breadcrumb className="product__breadcrumb">
            <Link to="/">Главная</Link> &nbsp; / &nbsp;
            <Link to="/catalog">Каталог</Link> &nbsp; / &nbsp;
            <Link to={`/catalog/${vendorCode}`}>Bluetooth Baseus Encok</Link>
          </Breadcrumb>
          <ModelTitle>{productToShow.title}</ModelTitle>
          <div className="product__rating">
            <Rating disabled rate={productToShow.rate} />
            <span className="product__rating-value">
              ( {productToShow.rate} из 5 )
            </span>
          </div>
          <div className="product__price">
            <Price
              price={productToShow.price}
              currency={productToShow.currency}
              className="product__price-real"
            />
            <LastPrice
              price={productToShow.lastPrice}
              currency={productToShow.currency}
              className="product__price-last"
            />
          </div>
          <div className="product__quantity">
            <ProductTitle>Количество:</ProductTitle>
            <StepperNum
              handlePlus={handlePlus}
              handleMinus={handleMinus}
              qty={qty}
              id={productToShow.id}
            />
          </div>
          <div className="product__color">
            <ProductTitle>Цвет:</ProductTitle>
            <div className="product__radio">
              <RadioBtn name="color">Черный</RadioBtn>
              <RadioBtn name="color">Белый</RadioBtn>
            </div>
          </div>
          <div className="product__buttons-buy">
            <PurpleButton className="product__button-purple">
              Купить в 1 клик
            </PurpleButton>
            <WhiteGrayButton
              className="product__button-gray"
              onClick={() => cart.onAdd(productToShow, productToShow.quantity)}
            >
              В корзину
            </WhiteGrayButton>
          </div>
          <div className="product-buttons-delete"></div>
        </div>
        <div className="product__more">
          <VendorCode className="product__vendor-code" item={productToShow} />
          <div className="product__statusbar">
            <div className="product__sale-deadline-box">
              <AttentionButton />
              <p className="product__sale-deadline">
                До конца акции осталось: <span>3 дня</span>
              </p>
            </div>
            <div className="product__status-buttons">
              <CompareButton />
              <FavoriteButton />
            </div>
          </div>
          <MoreInfo />
        </div>
      </div>
      <hr />

      <div className="product__data">
        <TabsProduct />
      </div>

      <div className="product__adds">
        <PageTitle style={{ marginBottom: 47 }}>Вас заинтересуют</PageTitle>
        <div className="product__adds-wrapper">
          {CATALOG.filter(({ isBanner }) => !isBanner)
            .filter((item, index) => index <= 3)
            .map((item) => (
              <CardProduct key={item.id} {...item} item={item} />
            ))}
        </div>
      </div>
    </div>
  );
};

export default ProductDesk;
